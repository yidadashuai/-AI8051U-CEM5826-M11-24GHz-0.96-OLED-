C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE oled
OBJECT MODULE PLACED IN .\Objects\oled.obj
COMPILER INVOKED BY: D:\keil c51&stm32&c251\Keil_v5\C251\BIN\C251.EXE oled.c XSMALL INTR2 BROWSE DEBUG PRINT(.\Listings\
                    -oled.lst) OBJECT(.\Objects\oled.obj) 

stmt  level    source

    1          #include "oled.h"
    2          #include "font.h"
    3          #include <STRING.H>
    4          
    5          
    6          unsigned char xdata ShowBUFF[8][128];                           //OLEDå…¨å±€ç¼“å­˜
    7          
    8          //========================================================================
    9          // å‡½æ•°åç§°: delay
   10          // å‡½æ•°åŠŸèƒ½: OLEDé©±åŠ¨ç”¨çš„å»¶æ—¶
   11          // å…¥å£å‚æ•°: æ— 
   12          // å‡½æ•°è¿”å›: æ— 
   13          // å½“å‰ç‰ˆæœ¬: VER1.0
   14          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   15          // å½“å‰ä½œè€…: ZCF
   16          // å…¶ä»–å¤‡æ³¨:
   17          //========================================================================
   18          void delay(void)
   19          {
   20   1          int xdata i;
   21   1          
   22   1          for (i=0; i<100; i++);
   23   1      }
   24          
   25          //========================================================================
   26          // å‡½æ•°åç§°: delay_ms
   27          // å‡½æ•°åŠŸèƒ½: mså»¶æ—¶å‡½æ•°
   28          // å…¥å£å‚æ•°: æ— 
   29          // å‡½æ•°è¿”å›: æ— 
   30          // å½“å‰ç‰ˆæœ¬: VER1.0
   31          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   32          // å½“å‰ä½œè€…: ZCF
   33          // å…¶ä»–å¤‡æ³¨:
   34          //========================================================================
   35          //void delay_ms(unsigned int ms)
   36          //{
   37          //     unsigned int xdata i;
   38          //     do{
   39          //          i = MAIN_Fosc / 6000;
   40          //          while(--i);   //6T per loop
   41          //     }while(--ms);
   42          //}
   43          
   44          //========================================================================
   45          // å‡½æ•°åç§°: OLED_WR_Byte
   46          // å‡½æ•°åŠŸèƒ½: OLEDåœ°å€/æ•°æ®å†™å…¥å‡½æ•°
   47          // å…¥å£å‚æ•°: @dat:æ•°æ®    @cmd:å‘½ä»¤
   48          // å‡½æ•°è¿”å›: æ— 
   49          // å½“å‰ç‰ˆæœ¬: VER1.0
   50          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   51          // å½“å‰ä½œè€…: ZCF
   52          // å…¶ä»–å¤‡æ³¨:
   53          //========================================================================
   54          void OLED_WR_Byte(unsigned char dat,unsigned char cmd)
   55          {
   56   1          unsigned char udat[1] ;
   57   1          udat[0] = dat;
   58   1          if( cmd==1 )
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 2   

   59   1              I2C_WriteNbyte(0X78,0x40,udat,1);
   60   1          else
   61   1              I2C_WriteNbyte(0X78,0x00,udat,1);
   62   1      }
   63          
   64          //========================================================================
   65          // å‡½æ•°åç§°: OLED_Init
   66          // å‡½æ•°åŠŸèƒ½: OLEDåˆå§‹åŒ–å‡½æ•°
   67          // å…¥å£å‚æ•°: æ— 
   68          // å‡½æ•°è¿”å›: æ— 
   69          // å½“å‰ç‰ˆæœ¬: VER1.0
   70          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   71          // å½“å‰ä½œè€…: ZCF
   72          // å…¶ä»–å¤‡æ³¨:
   73          //========================================================================
   74          void OLED_Init(void)
   75          {
   76   1      //    IIC_Init();
   77   1      //    delay_ms(100);
   78   1      //    delay_ms(200);
   79   1      
   80   1      
   81   1          OLED_WR_Byte(0xAE,OLED_CMD);//--turn off oled panel
   82   1          OLED_WR_Byte(0x00,OLED_CMD);//---set low column address
   83   1          OLED_WR_Byte(0x10,OLED_CMD);//---set high column address
   84   1          OLED_WR_Byte(0x40,OLED_CMD);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F
             -)
   85   1          OLED_WR_Byte(0x81,OLED_CMD);//--set contrast control register
   86   1          OLED_WR_Byte(0xCF,OLED_CMD);// Set SEG Output Current Brightness
   87   1          OLED_WR_Byte(0xA1,OLED_CMD);//--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
   88   1          OLED_WR_Byte(0xC8,OLED_CMD);//Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
   89   1          OLED_WR_Byte(0xA6,OLED_CMD);//--set normal display
   90   1          OLED_WR_Byte(0xA8,OLED_CMD);//--set multiplex ratio(1 to 64)
   91   1          OLED_WR_Byte(0x3f,OLED_CMD);//--1/64 duty
   92   1          OLED_WR_Byte(0xD3,OLED_CMD);//-set display offset   Shift Mapping RAM Counter (0x00~0x3F)
   93   1          OLED_WR_Byte(0x00,OLED_CMD);//-not offset
   94   1          OLED_WR_Byte(0xd5,OLED_CMD);//--set display clock divide ratio/oscillator frequency
   95   1          OLED_WR_Byte(0x80,OLED_CMD);//--set divide ratio, Set Clock as 100 Frames/Sec
   96   1          OLED_WR_Byte(0xD9,OLED_CMD);//--set pre-charge period
   97   1          OLED_WR_Byte(0xF1,OLED_CMD);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
   98   1          OLED_WR_Byte(0xDA,OLED_CMD);//--set com pins hardware configuration
   99   1          OLED_WR_Byte(0x12,OLED_CMD);
  100   1          OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
  101   1          OLED_WR_Byte(0x40,OLED_CMD);//Set VCOM Deselect Level
  102   1          OLED_WR_Byte(0x20,OLED_CMD);//-Set Page Addressing Mode (0x00/0x01/0x02)
  103   1          OLED_WR_Byte(0x02,OLED_CMD);//
  104   1          OLED_WR_Byte(0x8D,OLED_CMD);//--set Charge Pump enable/disable
  105   1          OLED_WR_Byte(0x14,OLED_CMD);//--set(0x10) disable
  106   1          OLED_WR_Byte(0xA4,OLED_CMD);// Disable Entire Display On (0xa4/0xa5)
  107   1          OLED_WR_Byte(0xA6,OLED_CMD);// Disable Inverse Display On (0xa6/a7) 
  108   1          OLED_WR_Byte(0xAF,OLED_CMD);
  109   1          OLED_BuffClear();
  110   1          OLED_BuffShow();
  111   1          OLED_DisplayOn();
  112   1      }
  113          
  114          
  115          //åæ˜¾å‡½æ•°
  116          void OLED_ColorTurn(u8 i)
  117          {
  118   1              if(i==0)
  119   1                      {
  120   2                              OLED_WR_Byte(0xA6,OLED_CMD);//æ­£å¸¸æ˜¾ç¤º
  121   2                      }
  122   1              if(i==1)
  123   1                      {
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 3   

  124   2                              OLED_WR_Byte(0xA7,OLED_CMD);//åè‰²æ˜¾ç¤º
  125   2                      }
  126   1      }
  127          
  128          //å±å¹•æ—‹è½¬180åº¦
  129          void OLED_DisplayTurn(u8 i)
  130          {
  131   1              if(i==0)
  132   1                      {
  133   2                              OLED_WR_Byte(0xC8,OLED_CMD);//æ­£å¸¸æ˜¾ç¤º
  134   2                              OLED_WR_Byte(0xA1,OLED_CMD);
  135   2                      }
  136   1              if(i==1)
  137   1                      {
  138   2                              OLED_WR_Byte(0xC0,OLED_CMD);//åè½¬æ˜¾ç¤º
  139   2                              OLED_WR_Byte(0xA0,OLED_CMD);
  140   2                      }
  141   1      }
  142          
  143          
  144          //========================================================================
  145          // å‡½æ•°åç§°: OLED_Set_Pos
  146          // å‡½æ•°åŠŸèƒ½: OLEDè®¾ç½®æ˜¾ç¤ºä½ç½®
  147          // å…¥å£å‚æ•°: @x:xåæ ‡     @y:yåæ ‡
  148          // å‡½æ•°è¿”å›: æ— 
  149          // å½“å‰ç‰ˆæœ¬: VER1.0
  150          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  151          // å½“å‰ä½œè€…: ZCF
  152          // å…¶ä»–å¤‡æ³¨:
  153          //========================================================================
  154          void OLED_Set_Pos(unsigned char x, unsigned char y) 
  155          { 
  156   1              OLED_WR_Byte((unsigned char)(0xb0+y),OLED_CMD);
  157   1              OLED_WR_Byte(((x&0xf0)>>4)|0x10,OLED_CMD);
  158   1              OLED_WR_Byte((x&0x0f),OLED_CMD); 
  159   1      }   
  160          
  161          
  162          //========================================================================
  163          // å‡½æ•°åç§°: OLED_DrawBMP
  164          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºå›¾ç‰‡
  165          // å…¥å£å‚æ•°: @x0:xèµ·ç‚¹  @y0:yèµ·ç‚¹    @x1:xç»ˆç‚¹   @y1:yç»ˆç‚¹  @BMPï¼šæ˜¾ç¤ºæ•°ç»„
  166          // å‡½æ•°è¿”å›: æ— 
  167          // å½“å‰ç‰ˆæœ¬: VER1.0
  168          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  169          // å½“å‰ä½œè€…: ZCF
  170          // å…¶ä»–å¤‡æ³¨:
  171          //========================================================================
  172          void OLED_DrawBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char BMP
             -[])
  173          {       
  174   1          unsigned int xdata j=0;
  175   1          unsigned char xdata x,y;
  176   1      
  177   1          for(y=y0;y<(y1+y0);y++)
  178   1          {
  179   2              OLED_Set_Pos(x0,y);
  180   2              for(x=0;x<x1;x++)
  181   2              {      
  182   3                  OLED_WR_Byte(BMP[j++],OLED_DATA);           
  183   3              }
  184   2          }
  185   1      } 
  186          
  187          //========================================================================
  188          // å‡½æ•°åç§°: OLED_DisplayOn
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 4   

  189          // å‡½æ•°åŠŸèƒ½: OLEDå¼€æ˜¾ç¤º
  190          // å…¥å£å‚æ•°: æ— 
  191          // å‡½æ•°è¿”å›: æ— 
  192          // å½“å‰ç‰ˆæœ¬: VER1.0
  193          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  194          // å½“å‰ä½œè€…: ZCF
  195          // å…¶ä»–å¤‡æ³¨:
  196          //========================================================================
  197          void OLED_DisplayOn(void)     //å¼€æ˜¾ç¤º
  198          {
  199   1          OLED_WR_Byte(0x8D,OLED_CMD);//ç”µè·æ³µä½¿èƒ½
  200   1          OLED_WR_Byte(0x14,OLED_CMD);//å¼€å¯ç”µè·æ³µ
  201   1          OLED_WR_Byte(0xAF,OLED_CMD);//ç‚¹äº®å±å¹•       
  202   1      }
  203            
  204          //========================================================================
  205          // å‡½æ•°åç§°: OLED_DisplayOff
  206          // å‡½æ•°åŠŸèƒ½: OLEDå…³æ˜¾ç¤º
  207          // å…¥å£å‚æ•°: æ— 
  208          // å‡½æ•°è¿”å›: æ— 
  209          // å½“å‰ç‰ˆæœ¬: VER1.0
  210          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  211          // å½“å‰ä½œè€…: ZCF
  212          // å…¶ä»–å¤‡æ³¨:
  213          //========================================================================
  214          void OLED_DisplayOff(void)     //å…³æ˜¾ç¤º
  215          {
  216   1          OLED_WR_Byte(0x8D,OLED_CMD);//ç”µè·æ³µä½¿èƒ½
  217   1          OLED_WR_Byte(0x10,OLED_CMD);//å…³é—­ç”µè·æ³µ
  218   1          OLED_WR_Byte(0xAF,OLED_CMD);//å…³é—­å±å¹•        
  219   1      }
  220          
  221          //========================================================================
  222          // å‡½æ•°åç§°: OLED_LightSet
  223          // å‡½æ•°åŠŸèƒ½: OLEDäº®åº¦è®¾ç½®
  224          // å…¥å£å‚æ•°: @numï¼š 0-255
  225          // å‡½æ•°è¿”å›: æ— 
  226          // å½“å‰ç‰ˆæœ¬: VER1.0
  227          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  228          // å½“å‰ä½œè€…: ZCF
  229          // å…¶ä»–å¤‡æ³¨:
  230          //========================================================================
  231          void OLED_LightSet(unsigned char num)     //äº®åº¦è®¾ç½®
  232          {
  233   1          OLED_WR_Byte(0x81,OLED_CMD);//
  234   1          OLED_WR_Byte(num,OLED_CMD);//  
  235   1          OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
  236   1          OLED_WR_Byte(0x20,OLED_CMD);//Set VCOM Deselect Level   
  237   1      }
  238          
  239          
  240          //========================================================================
  241          // å‡½æ•°åç§°: OLED_BuffClear
  242          // å‡½æ•°åŠŸèƒ½: OLEDæ¸…ç©ºç¼“å­˜
  243          // å…¥å£å‚æ•°: æ— 
  244          // å‡½æ•°è¿”å›: æ— 
  245          // å½“å‰ç‰ˆæœ¬: VER1.0
  246          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  247          // å½“å‰ä½œè€…: ZCF
  248          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  249          //========================================================================
  250          void OLED_BuffClear(void)     //æ¸…å±
  251          {
  252   1          memset(ShowBUFF,0,128*8);
  253   1      }
  254          
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 5   

  255          //========================================================================
  256          // å‡½æ•°åç§°: OLED_BuffShow_NoInterrupt
  257          // å‡½æ•°åŠŸèƒ½: OLEDåˆ·æ–°æ˜¾ç¤º(å…³åœä¸­æ–­)
  258          // å…¥å£å‚æ•°: æ— 
  259          // å‡½æ•°è¿”å›: æ— 
  260          // å½“å‰ç‰ˆæœ¬: VER1.0
  261          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 31
  262          // å½“å‰ä½œè€…: PatZer0
  263          // å…¶ä»–å¤‡æ³¨: åœ¨åˆ·æ–°å±å¹•æ—¶ï¼Œæš‚æ—¶å…³é—­ä¸­æ–­ï¼Œä»¥é¿å…ä¸­æ–­ä¸­æ–­åˆ·æ–°å±å¹•I2Cé€šä¿¡ï¼Œå
             -¯¼è‡´æ˜¾ç¤ºä¸å…¨/ä¹±ç 
  264          //========================================================================
  265          void OLED_BuffShow_NoInterrupt(void)     
  266          {
  267   1          EA = 0;
  268   1          OLED_BuffShow();
  269   1          EA = 1;
  270   1      }
  271          
  272          //========================================================================
  273          // å‡½æ•°åç§°: OLED_BuffShow
  274          // å‡½æ•°åŠŸèƒ½: OLEDåˆ·æ–°æ˜¾ç¤º
  275          // å…¥å£å‚æ•°: æ— 
  276          // å‡½æ•°è¿”å›: æ— 
  277          // å½“å‰ç‰ˆæœ¬: VER1.1
  278          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  279          // å½“å‰ä½œè€…: ZCF, PatZer0
  280          // å…¶ä»–å¤‡æ³¨:
  281          //========================================================================
  282          void OLED_BuffShow(void)     
  283          {
  284   1          unsigned char xdata i,n,j;
  285   1          for(i=0;i<8;i++)
  286   1          {
  287   2              j = 0xb0 + i;             //C251æ›´åŠ ä¸¥è°¨ï¼Œè¿™æ ·å†™ä»¥é¿å…warning
  288   2              OLED_WR_Byte(j,OLED_CMD); //è®¾ç½®è¡Œèµ·å§‹åœ°å€
  289   2              OLED_WR_Byte(0x00,OLED_CMD);   //è®¾ç½®ä½åˆ—èµ·å§‹åœ°å€    // 2024.03.27ä¿®æ”¹ä½åˆ—èµ·å§‹ï¼Œå
             -¦åˆ™æµ‹è¯•ç”¨å±å¹•æ˜¾ç¤ºä¸å…¨0x02
  290   2              OLED_WR_Byte(0x10,OLED_CMD);   //è®¾ç½®é«˜åˆ—èµ·å§‹åœ°å€
  291   2      
  292   2              for(n=0;n<128;n++)
  293   2                  OLED_WR_Byte(ShowBUFF[i][n],OLED_DATA);
  294   2          }
  295   1      }
  296          
  297          //========================================================================
  298          // å‡½æ•°åç§°: OLED_BuffShowPoint
  299          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªç‚¹
  300          // å…¥å£å‚æ•°: @xï¼šxèµ·ç‚¹   @y:yèµ·ç‚¹
  301          // å‡½æ•°è¿”å›: æ— 
  302          // å½“å‰ç‰ˆæœ¬: VER1.0
  303          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  304          // å½“å‰ä½œè€…: ZCF
  305          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  306          //========================================================================
  307          void OLED_BuffShowPoint(unsigned char x,unsigned char y)     //OLEDæ˜¾ç¤ºä¸€ä¸ªç‚¹
  308          {
  309   1          ShowBUFF[y/8][x] |= 1<<(y%8);
  310   1      }
  311          
  312          //========================================================================
  313          // å‡½æ•°åç§°: OLED_BuffShowPoint
  314          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€æ¡çº¿
  315          // å…¥å£å‚æ•°: @x1ï¼šxèµ·ç‚¹  @y1ï¼šyèµ·ç‚¹  @x2ï¼šxç»ˆç‚¹   @y2ï¼šyç»ˆç‚¹
  316          // å‡½æ•°è¿”å›: æ— 
  317          // å½“å‰ç‰ˆæœ¬: VER1.0
  318          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 6   

  319          // å½“å‰ä½œè€…: ZCF
  320          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  321          //========================================================================
  322          void OLED_BuffShowLine( unsigned char x1, unsigned char y1, unsigned char x2,unsigned char y2)
  323          {
  324   1          unsigned char x,y;
  325   1          if( x1>x2 )
  326   1          {
  327   2              x=x1;x1=x2;x2=x;
  328   2              y=y1;y1=y2;y2=y;
  329   2          }
  330   1          if(x1!=x2)
  331   1          {
  332   2              for( x = x1; x <= x2; x++ )
  333   2              {
  334   3                  if( y2>y1 )
  335   3                      OLED_BuffShowPoint(x, (unsigned char)(y1+(unsigned int)(y2-y1)*(unsigned int)x/(unsigned 
             -int)(x2-x1)));
  336   3                  else
  337   3                      OLED_BuffShowPoint(x, (unsigned char)(y1-(unsigned int)(y1-y2)*(unsigned int)x/(unsigned 
             -int)(x2-x1)));
  338   3              }        
  339   2          }
  340   1          else
  341   1          {
  342   2              if( y1>y2 )
  343   2              {
  344   3                  for( y = y2; y <= y1; y++ )
  345   3                     OLED_BuffShowPoint(x1, y); 
  346   3              }
  347   2              else
  348   2              {
  349   3                  for( y = y1; y <= y2; y++ )
  350   3                     OLED_BuffShowPoint(x1, y);             
  351   3              }
  352   2          }
  353   1      }
  354          
  355          //========================================================================
  356          // å‡½æ•°åç§°: OLED_BuffShowRectangle
  357          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªçŸ©å½¢
  358          // å…¥å£å‚æ•°: @x1ï¼šxèµ·ç‚¹  @y1ï¼šyèµ·ç‚¹  @x2ï¼šxç»ˆç‚¹   @y2ï¼šyç»ˆç‚¹
  359          // å‡½æ•°è¿”å›: æ— 
  360          // å½“å‰ç‰ˆæœ¬: VER1.0
  361          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  362          // å½“å‰ä½œè€…: ZCF
  363          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  364          //========================================================================
  365          void OLED_BuffShowRectangle(unsigned char x1, unsigned char y1, unsigned char x2, unsigned char y2)
  366          {
  367   1          OLED_BuffShowLine(x1, y1, x2, y1);
  368   1          OLED_BuffShowLine(x1, y1, x1, y2);
  369   1          OLED_BuffShowLine(x1, y2, x2, y2);
  370   1          OLED_BuffShowLine(x2, y1, x2, y2);
  371   1      }
  372          
  373          //========================================================================
  374          // å‡½æ•°åç§°: OLED_BuffShowCircle
  375          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªåœ†å½¢
  376          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @r:åŠå¾„
  377          // å‡½æ•°è¿”å›: æ— 
  378          // å½“å‰ç‰ˆæœ¬: VER1.1
  379          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  380          // å½“å‰ä½œè€…: ZCF, PatZer0
  381          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  382          //========================================================================
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 7   

  383          void OLED_BuffShowCircle(unsigned char x, unsigned char y, unsigned char r)
  384          {
  385   1          int a, b;
  386   1          int di;
  387   1          unsigned char x_add_a, x_add_b, x_sub_a, x_sub_b, y_add_a, y_add_b, y_sub_a, y_sub_b;
  388   1      
  389   1          a = 0;
  390   1          b = r;
  391   1          di = 3 - (r << 1);       //åˆ¤æ–­ä¸‹ä¸ªç‚¹ä½ç½®çš„æ ‡å¿—
  392   1       
  393   1          while (a <= b)
  394   1          {
  395   2              x_add_a = x + a;
  396   2              x_add_b = x + b;
  397   2              x_sub_a = x - a;
  398   2              x_sub_b = x - b;
  399   2              y_add_a = y + a;
  400   2              y_add_b = y + b;
  401   2              y_sub_a = y - a;
  402   2              y_sub_b = y - b;
  403   2              OLED_BuffShowPoint(x_add_a, y_sub_b);        //5
  404   2              OLED_BuffShowPoint(x_add_b, y_sub_a);        //0
  405   2              OLED_BuffShowPoint(x_sub_b, y_add_a);        //4
  406   2              OLED_BuffShowPoint(x_sub_a, y_add_b);        //6
  407   2              OLED_BuffShowPoint(x_sub_a, y_sub_b);        //1
  408   2              OLED_BuffShowPoint(x_add_b, y_add_a);
  409   2              OLED_BuffShowPoint(x_sub_b, y_sub_a);        //2
  410   2              OLED_BuffShowPoint(x_add_a, y_add_b);        //7
  411   2              //é‡å†™ä»£ç ï¼Œé¿å…C251æŠ¥Warning
  412   2      
  413   2              a++;
  414   2       
  415   2              //ä½¿ç”¨Bresenhamç®—æ³•ç”»åœ†
  416   2              if (di < 0)di += 4 * a + 6;
  417   2              else
  418   2              {
  419   3                  di += 10 + 4 * (a - b);
  420   3                  b--;
  421   3              }
  422   2          }
  423   1      }
  424          
  425          //========================================================================
  426          // å‡½æ•°åç§°: OLED_BuffShowChar
  427          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ª8*16çš„å­—ç¬¦
  428          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @asc:å­—ç¬¦   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  429          // å‡½æ•°è¿”å›: æ— 
  430          // å½“å‰ç‰ˆæœ¬: VER1.0
  431          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  432          // å½“å‰ä½œè€…: ZCF
  433          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  434          //========================================================================
  435          void OLED_BuffShowChar(unsigned char x,unsigned char y,char asc, unsigned char mode)     //OLEDæ˜¾ç¤ºä¸€ä
             -¸ª8*16å­—ç¬¦
  436          {
  437   1          unsigned char j,k;
  438   1          for( j=0;j<2;j++ )
  439   1          {
  440   2              for( k=0;k<8;k++ )
  441   2              {
  442   3                  if(mode==0)            
  443   3                      ShowBUFF[j+y][x+k]=Ascll_16[(asc-' ')*2][j*8+k];
  444   3                  else
  445   3                      ShowBUFF[j+y][x+k]=~Ascll_16[(asc-' ')*2][j*8+k];
  446   3              }
  447   2          }
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 8   

  448   1                              
  449   1      }
  450          
  451          //m^nå‡½æ•°
  452          u32 oled_pow(u8 m,u8 n)
  453          {
  454   1                      u32 result=1;    
  455   1                      while(n--)result*=m;    
  456   1                      return result;
  457   1      }                                 
  458          //========================================================================
  459          // å‡½æ•°åç§°: OLED_BuffShowGBK
  460          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºæ±‰å­—
  461          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @gbk:æ±‰å­—   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  462          // å‡½æ•°è¿”å›: æ— 
  463          // å½“å‰ç‰ˆæœ¬: VER1.1
  464          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 29
  465          // å½“å‰ä½œè€…: ZCF, PatZer0
  466          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  467          //          ç”¨åˆ°çš„æ±‰å­—éœ€è¦è‡ªå·±å–æ¨¡æ”¾åˆ°å­—åº“é‡Œï¼Œå­—åº“å¤šçš„è¯ï¼Œè¿™é‡Œè¿™ä¸ªå¾ªç¯å˜é‡
             -è¦æ”¾å¤§
  468          //          å­—åº“æ–‡ä»¶font.hé‡Œæœ‰æ±‰å­—çš„GBK16æ•°ç»„ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹
  469          //          åŸä»£ç ä½¿ç”¨å›ºå®šçš„éå†æ¬¡æ•°ï¼Œè¿™é‡Œç›´æ¥æ”¹ä¸ºGBK16æ•°ç»„å¤§å°ï¼Œç¡®ä¿æ‰€æœ‰å­—å
             -º“éƒ½è¢«éå†
  470          //========================================================================
  471          void OLED_BuffShowGBK(unsigned char x,unsigned char y,char *gbk,unsigned char mode)     //OLEDæ˜¾ç¤ºä¸€ä¸
             -ª16*16æ±‰å­—
  472          {
  473   1          unsigned char i;
  474   1          unsigned char j,k;
  475   1          for( i=0;i<sizeof(GBK16)/sizeof(GBK16[0]);i++ )
  476   1          {
  477   2              if((gbk[0] == GBK16[i].gbn_bum[0])
  478   2               &&(gbk[1] == GBK16[i].gbn_bum[1])
  479   2                              )
  480   2              {
  481   3                  for( j=0;j<2;j++ )
  482   3                  {
  483   4                      for( k=0;k<16;k++ )
  484   4                      {
  485   5                          if( mode ==0 )
  486   5                              ShowBUFF[j+y][x+k]=GBK16[i].gbk_font[j*16+k];
  487   5                          else
  488   5                              ShowBUFF[j+y][x+k]=~GBK16[i].gbk_font[j*16+k];
  489   5                      }
  490   4                  }
  491   3                  break;
  492   3              }
  493   2          }    
  494   1      }
  495          
  496          //========================================================================
  497          // å‡½æ•°åç§°: OLED_BuffShowString
  498          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²ã€‚æ±‰å­—å­—ç¬¦å‡å¯
  499          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @så­—ç¬¦ä¸²   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  500          // å‡½æ•°è¿”å›: æ— 
  501          // å½“å‰ç‰ˆæœ¬: VER1.0
  502          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  503          // å½“å‰ä½œè€…: ZCF
  504          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  505          //          ç”¨åˆ°çš„æ±‰å­—éœ€è¦è‡ªå·±å–æ¨¡æ”¾åˆ°å­—åº“é‡Œï¼Œå­—åº“å¤šçš„è¯ï¼Œè¿™é‡Œè¿™ä¸ªå¾ªç¯å˜é‡
             -è¦æ”¾å¤§
  506          //========================================================================
  507          void OLED_BuffShowString(unsigned char x,unsigned char y,char *s,unsigned char mode)
  508          {
  509   1          char s_num[2];
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 9   

  510   1              while(*s != '\0')       //å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œå¾ªç¯
  511   1              {
  512   2              if ((unsigned char)*s < 0x80)     //æ ¹æ®è¾“å…¥æ•°æ®çš„å¤§å°åˆ¤æ–­æ˜¯å­—ç¬¦è¿˜æ˜¯æ±‰å­—ï¼Œ
  513   2              {
  514   3                  OLED_BuffShowChar(x,y,*s,mode);
  515   3                  x+=8;
  516   3                  s++;
  517   3              }
  518   2              else
  519   2              {
  520   3                  s_num[0] = *s ;
  521   3                  s_num[1] = *(s+1) ;
  522   3                  OLED_BuffShowGBK(x,y,s_num,mode);
  523   3                  x+=16;
  524   3                  s+=2;
  525   3              }
  526   2                      if(x>127)
  527   2              {
  528   3                  x=0;
  529   3                  y+=2;
  530   3              }
  531   2              }       
  532   1      }
  533          
  534          //========================================================================
  535          // å‡½æ•°åç§°: OLED_BuffShowNum
  536          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºæ•´å½¢å˜é‡
  537          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šæ•´å½¢å˜é‡   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  538          // å‡½æ•°è¿”å›: æ— 
  539          // å½“å‰ç‰ˆæœ¬: VER1.1
  540          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  541          // å½“å‰ä½œè€…: ZCF, PatZer0
  542          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  543          //========================================================================
  544          void OLED_BuffShowNum(unsigned char x,unsigned char y,long num,unsigned char mode)
  545          {
  546   1          unsigned char xdata str[10];
  547   1          memset(str,0,10);
  548   1          sprintf(str,"%ld",num);
  549   1          OLED_BuffShowString(x,y,(unsigned char*)str, mode);
  550   1      }
  551          
  552          //========================================================================
  553          // å‡½æ•°åç§°: OLED_BuffShowNum02F
  554          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªä¸¤ä½å°æ•°å˜é‡
  555          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šå°æ•°å˜é‡   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  556          // å‡½æ•°è¿”å›: æ— 
  557          // å½“å‰ç‰ˆæœ¬: VER1.0
  558          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  559          // å½“å‰ä½œè€…: ZCF
  560          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  561          //========================================================================
  562          void OLED_BuffShowNum02F(unsigned char x,unsigned char y,float num,unsigned char mode)
  563          {
  564   1          unsigned char xdata str[10];
  565   1          memset(str,0,10);
  566   1          sprintf(str,"%.2f",num);
  567   1          OLED_BuffShowString(x,y,(unsigned char*)str,mode);
  568   1      }
  569          
  570          
  571          //========================================================================
  572          // å‡½æ•°åç§°: OLED_BuffShowChar32
  573          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤º16*32çš„å­—ç¬¦
  574          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šæ˜¾ç¤ºç¬¬å‡ ä¸ªå­—ç¬¦   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  575          // å‡½æ•°è¿”å›: æ— 
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 10  

  576          // å½“å‰ç‰ˆæœ¬: VER1.0
  577          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  578          // å½“å‰ä½œè€…: ZCF
  579          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  580          //          ç”¨åˆ°çš„éœ€è¦è‡ªå·±å–æ¨¡å“¦
  581          //========================================================================
  582          void OLED_BuffShowChar32(unsigned char  x,unsigned char  y,unsigned char num, unsigned char mode)     
  583          {
  584   1          unsigned char j,k;
  585   1          for( j=0;j<4;j++ )
  586   1          {
  587   2              for( k=0;k<16;k++ )
  588   2              {
  589   3                  if( mode==0 )
  590   3                      ShowBUFF[j+y][x+k]=lib_num1632[num][j*16+k];
  591   3                  else
  592   3                      ShowBUFF[j+y][x+k]=~lib_num1632[num][j*16+k];
  593   3              }
  594   2          }            
  595   1      }
  596          
  597          
  598          //========================================================================
  599          // å‡½æ•°åç§°: OLED_BuffShowBMP
  600          // å‡½æ•°åŠŸèƒ½: OLEDç¼“å­˜å†™å…¥å›¾ç‰‡
  601          // å…¥å£å‚æ•°: @x0:xèµ·ç‚¹  @y0:yèµ·ç‚¹    @x1:xç»ˆç‚¹   @y1:yç»ˆç‚¹  @BMPï¼šæ˜¾ç¤ºæ•°ç»„
  602          // å‡½æ•°è¿”å›: æ— 
  603          // å½“å‰ç‰ˆæœ¬: VER1.0
  604          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  605          // å½“å‰ä½œè€…: ZCF
  606          // å…¶ä»–å¤‡æ³¨:
  607          //========================================================================
  608          void OLED_BuffShowBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char
             - BMP[])
  609          {       
  610   1          unsigned int xdata num=0;
  611   1          unsigned char k,j;
  612   1          
  613   1          for( j=0;j<y1;j++ )
  614   1          {
  615   2              for( k=0;k<x1;k++ )
  616   2              {
  617   3                  ShowBUFF[j+y0][x0+k]=BMP[num++];
  618   3              }
  619   2          }  
  620   1      } 
  621           


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      5353     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =      1024         23
  xdata-const size     =    ------     ------
  edata size           =    ------         33
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         9     ------
C251 COMPILER V5.60.0,  oled                                                               01/12/24  22:45:24  PAGE 11  

End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
